{"mappings":"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","sources":["index.js"],"sourcesContent":["const SERVER_URL = \"/api\";\nconst status_maps = [\"OPRIT\", \"PAUZA\", \"PORNIT\"];\n\nconst status_value = document.querySelector(\"#status_value\");\nconst min_temp_value = document.querySelector(\"#min_temp_value\");\nconst max_temp_value = document.querySelector(\"#max_temp_value\");\nconst current_temp_value = document.querySelector(\"#current_temp_value\");\nconst pause_time_value = document.querySelector(\"#pause_time_value\");\nconst work_time_input = document.querySelector(\"#work_time_input\");\nconst pause_time_input = document.querySelector(\"#pause_time_input\");\n\nconst min_temp_dialog = document.querySelector('#min_temp_dialog');\nconst max_temp_dialog = document.querySelector('#max_temp_dialog');\nconst advanced_dialog = document.querySelector('#advanced_dialog');\nconst auth_dialog = document.querySelector('#auth_dialog');\n\nconst min_temp_btn = document.querySelector('#min_temp_btn');\nconst max_temp_btn = document.querySelector('#max_temp_btn');\nconst advanced_btn = document.querySelector('#advanced_btn');\n\nlet password = window.localStorage.getItem('pass') || \"\";\nlet fetch_interval;\nlet temp_chart_instance = undefined;\nlet power_chart_instance = undefined;\n\nfunction getData(path) {\n  return new Promise(function(resolve, reject) {\n    fetch(SERVER_URL + \"/\" + path, {\n      method: \"GET\",\n      headers: {\n        'Authorization': password\n      },\n    }).then(function(res) {\n      if (res.ok) {\n        res.json().then(function(json) {\n          resolve(json);\n        });\n      } else {\n        reject(res.statusText);\n      }\n    }).catch(function(err) {\n      reject(err);\n    });\n  });\n}\n\nfunction setData(path, data) {\n  return new Promise(function(resolve, reject) {\n    fetch(SERVER_URL + \"/\" + path, {\n      method: \"POST\",\n      body: data,\n      headers: {\n        'Authorization': password\n      },\n    }).then(function(res) {\n      if (res.ok) {\n        res.json().then(function(json) {\n          resolve(json);\n        });\n      } else {\n        reject(res.statusText);\n      }\n    }).catch(function(err) {\n      reject(err);\n    });\n  });\n}\n\nfunction fetchData() {\n  const requests = [\"status\", \"current_temp\", \"min_temp\", \"max_temp\", \"work_time\", \"pause_time\", \"timeline\", \"timeline_temp\", \"timeline_power\"];\n  Promise.all(requests.map(path => getData(path))).then(function(results) {\n    const resultObj = requests.reduce(function(acc, path, index) {\n      acc[path] = results[index].result;\n      return acc;\n    }, {});\n    status_value.innerHTML = isNaN(resultObj.status) ? \"n/a\" : status_maps[Number(resultObj.status)];\n    min_temp_value.innerHTML = resultObj.min_temp || \"n/a\";\n    max_temp_value.innerHTML = resultObj.max_temp || \"n/a\";\n    current_temp_value.innerHTML = resultObj.current_temp || \"n/a\";\n    pause_time_value.innerHTML = isNaN(resultObj.pause_time) ? \"n/a\" : Number(resultObj.pause_time) / 60;\n    work_time_input.value = isNaN(resultObj.work_time) ? \"n/a\" : Number(resultObj.work_time) / 60;\n    pause_time_input.value = isNaN(resultObj.pause_time) ? \"n/a\" : Number(resultObj.pause_time) / 60;\n    let dates = resultObj.timeline.length ? resultObj.timeline.filter(function (e,i){return i%10 === 0;}).slice(-1440) : [];\n    if (dates.length) {\n      const [month, day, hour, min, sec] = dates[dates.length - 1].match(/..?/g);\n      document.querySelector('#last_sync_value').innerHTML = `${month}/${day} ${hour}:${min}`;\n    } else {\n      document.querySelector('#last_sync_value').innerHTML = 'n/a';\n    }\n    dates = dates.map(function(dt) {\n      const [month, day, hour, min, sec] = dt.match(/..?/g);\n      //const now = new Date();\n      return `${month}/${day} ${hour}:${min}`;\n    });\n    const temp_values = resultObj.timeline_temp.filter(function (e,i){return i%10 === 0;}).slice(-1440);\n    const power_values = resultObj.timeline_power.filter(function (e,i){return i%10 === 0;}).slice(-1440);\n    if (temp_chart_instance) {\n      temp_chart_instance.destroy();\n    }\n    if (power_chart_instance) {\n      power_chart_instance.destroy();\n    }\n    try {\n      temp_chart_instance = new Chart(\"temp_chart\", {\n        type: \"line\",\n        data: {\n          labels: dates,\n          datasets: [{\n            label: \"Temperatura\",\n            fill: false,\n            lineTension: 0,\n            backgroundColor: \"rgba(255,0,0,1.0)\",\n            borderColor: \"rgba(255,0,0,0.75)\",\n            data: temp_values\n          }]\n        }\n      });\n      power_chart_instance = new Chart(\"power_chart\", {\n        type: \"line\",\n        data: {\n          labels: dates,\n          datasets: [{\n            label: \"Energie\",\n            fill: false,\n            lineTension: 0,\n            backgroundColor: \"rgba(0,0,255,1.0)\",\n            borderColor: \"rgba(0,0,255,0.75)\",\n            data: power_values\n          }]\n        }\n      });\n    } catch(err) {\n      console.log(err);\n    }\n  }).catch(function(err) {\n    console.log(err);\n    clearInterval(fetch_interval);\n    alert(\"Nu se poate comunica cu serverul!\");\n    auth_dialog.style.display = 'block';\n  });\n}\n\nif (!password) {\n  auth_dialog.style.display = 'block';\n} else {\n  fetchData();\n  fetch_interval = setInterval(fetchData, 30000);\n}\n\nauth_dialog.querySelector(\".submit\").addEventListener('click', function() {\n  auth_dialog.style.display = 'none';\n \n  clearInterval(fetch_interval);\n  password = auth_dialog.querySelector(\"#pass_input\").value;\n  setTimeout(fetchData, 100);\n  fetchData();\n  fetch_interval = setInterval(fetchData, 30000);\n  window.localStorage.setItem('pass', password);\n});\n\nmin_temp_btn.addEventListener('click', function() {\n  const current = parseFloat(min_temp_value.innerHTML);\n  document.querySelector(\"#min_input\").value = current;\n  min_temp_dialog.style.display = 'block';\n});\nmin_temp_dialog.querySelector('.close').addEventListener('click', function() {\n  min_temp_dialog.style.display = 'none'; \n});\nmin_temp_dialog.querySelector('.submit').addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  setData('min_temp', current);\n  setTimeout(fetchData, 100);\n  min_temp_dialog.style.display = 'none';\n});\nmin_temp_dialog.querySelector(\"#plus_min_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  document.querySelector(\"#min_input\").value = (current + 0.1).toFixed(1);\n});\nmin_temp_dialog.querySelector(\"#minus_min_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  document.querySelector(\"#min_input\").value = (current - 0.1).toFixed(1);\n});\n\nmax_temp_btn.addEventListener('click', function() {\n  const current = parseFloat(max_temp_value.innerHTML);\n  document.querySelector(\"#max_input\").value = current;\n  max_temp_dialog.style.display = 'block';\n});\nmax_temp_dialog.querySelector('.close').addEventListener('click', function() {\n  max_temp_dialog.style.display = 'none';\n});\nmax_temp_dialog.querySelector('.submit').addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  setData('max_temp', current);\n  setTimeout(fetchData, 100);\n  max_temp_dialog.style.display = 'none';\n});\nmax_temp_dialog.querySelector(\"#plus_max_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  document.querySelector(\"#max_input\").value = (current + 0.1).toFixed(1);\n});\nmax_temp_dialog.querySelector(\"#minus_max_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  document.querySelector(\"#max_input\").value = (current - 0.1).toFixed(1);\n});\n\nadvanced_btn.addEventListener('click', function() {\n  advanced_dialog.style.display = 'block';\n});\nadvanced_dialog.querySelector('.close').addEventListener('click', function() {\n  advanced_dialog.style.display = 'none'; \n});\nadvanced_dialog.querySelector('.submit').addEventListener('click', function() {\n  advanced_dialog.style.display = 'none';\n  const work = parseInt(document.querySelector(\"#work_time_input\").value);\n  const pause = parseInt(document.querySelector(\"#pause_time_input\").value);\n  setData('work_time', work * 60);\n  setData('pause_time', pause * 60);\n  setTimeout(fetchData, 100);\n});\nadvanced_dialog.querySelector(\"#plus_work_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#work_time_input\").value);\n  document.querySelector(\"#work_time_input\").value = (current + 10);\n});\nadvanced_dialog.querySelector(\"#minus_work_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#work_time_input\").value);\n  document.querySelector(\"#work_time_input\").value = (current - 10);\n});\nadvanced_dialog.querySelector(\"#plus_pause_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#pause_time_input\").value);\n  document.querySelector(\"#pause_time_input\").value = (current + 10);\n});\nadvanced_dialog.querySelector(\"#minus_pause_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#pause_time_input\").value);\n  document.querySelector(\"#pause_time_input\").value = (current - 10);\n});\n\n"],"names":["$f7cc2df98f0dd786ece54ee206a6d458$var$status_maps","$f7cc2df98f0dd786ece54ee206a6d458$var$status_value","document","querySelector","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$current_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$pause_time_value","$f7cc2df98f0dd786ece54ee206a6d458$var$work_time_input","$f7cc2df98f0dd786ece54ee206a6d458$var$pause_time_input","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$advanced_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$auth_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$advanced_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$fetch_interval","$f7cc2df98f0dd786ece54ee206a6d458$var$temp_chart_instance","$f7cc2df98f0dd786ece54ee206a6d458$var$power_chart_instance","$f7cc2df98f0dd786ece54ee206a6d458$var$password","window","localStorage","getItem","$f7cc2df98f0dd786ece54ee206a6d458$var$setData","path","data","Promise","resolve","reject","fetch","$f7cc2df98f0dd786ece54ee206a6d458$var$SERVER_URL","method","body","headers","then","res","ok","json","statusText","catch","err","$f7cc2df98f0dd786ece54ee206a6d458$var$fetchData","requests","all","map","$f7cc2df98f0dd786ece54ee206a6d458$var$getData","results","resultObj","reduce","acc","index","result","innerHTML","isNaN","status","Number","min_temp","max_temp","current_temp","pause_time","value","work_time","dates","timeline","length","filter","e","i","slice","month","day","hour","min","sec","match","dt","temp_values","timeline_temp","power_values","timeline_power","destroy","Chart","type","labels","datasets","label","fill","lineTension","backgroundColor","borderColor","console","log","clearInterval","alert","style","display","setInterval","addEventListener","setTimeout","setItem","current","parseFloat","toFixed","work","parseInt","pause"],"version":3,"file":"index.a391472f.js.map"}