{"mappings":"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","sources":["index.js"],"sourcesContent":["const SERVER_URL = \"/api\";\nconst status_maps = [\"OPRIT\", \"PAUZA\", \"PORNIT\"];\n\nconst status_value = document.querySelector(\"#status_value\");\nconst min_temp_value = document.querySelector(\"#min_temp_value\");\nconst max_temp_value = document.querySelector(\"#max_temp_value\");\nconst current_temp_value = document.querySelector(\"#current_temp_value\");\nconst pause_time_value = document.querySelector(\"#pause_time_value\");\nconst work_time_input = document.querySelector(\"#work_time_input\");\nconst pause_time_input = document.querySelector(\"#pause_time_input\");\n\nconst min_temp_dialog = document.querySelector('#min_temp_dialog');\nconst max_temp_dialog = document.querySelector('#max_temp_dialog');\nconst advanced_dialog = document.querySelector('#advanced_dialog');\nconst auth_dialog = document.querySelector('#auth_dialog');\n\nconst min_temp_btn = document.querySelector('#min_temp_btn');\nconst max_temp_btn = document.querySelector('#max_temp_btn');\nconst advanced_btn = document.querySelector('#advanced_btn');\n\nlet password = window.localStorage.getItem('pass') || \"\";\nlet fetch_interval;\nlet temp_chart_instance = undefined;\nlet power_chart_instance = undefined;\n\nfunction getData(path) {\n  return new Promise(function(resolve, reject) {\n    fetch(SERVER_URL + \"/\" + path, {\n      method: \"GET\",\n      headers: {\n        'Authorization': password\n      },\n    }).then(function(res) {\n      if (res.ok) {\n        res.json().then(function(json) {\n          resolve(json);\n        });\n      } else {\n        reject(res.statusText);\n      }\n    }).catch(function(err) {\n      reject(err);\n    });\n  });\n}\n\nfunction setData(path, data) {\n  return new Promise(function(resolve, reject) {\n    fetch(SERVER_URL + \"/\" + path, {\n      method: \"POST\",\n      body: data,\n      headers: {\n        'Authorization': password\n      },\n    }).then(function(res) {\n      if (res.ok) {\n        res.json().then(function(json) {\n          resolve(json);\n        });\n      } else {\n        reject(res.statusText);\n      }\n    }).catch(function(err) {\n      reject(err);\n    });\n  });\n}\n\nfunction fetchData() {\n  const requests = [\"status\", \"current_temp\", \"min_temp\", \"max_temp\", \"work_time\", \"pause_time\", \"timeline\", \"timeline_temp\", \"timeline_power\"];\n  Promise.all(requests.map(path => getData(path))).then(function(results) {\n    const resultObj = requests.reduce(function(acc, path, index) {\n      acc[path] = results[index].result;\n      return acc;\n    }, {});\n    status_value.innerHTML = isNaN(resultObj.status) ? \"n/a\" : status_maps[Number(resultObj.status)];\n    min_temp_value.innerHTML = resultObj.min_temp || \"n/a\";\n    max_temp_value.innerHTML = resultObj.max_temp || \"n/a\";\n    current_temp_value.innerHTML = resultObj.current_temp || \"n/a\";\n    pause_time_value.innerHTML = isNaN(resultObj.pause_time) ? \"n/a\" : Number(resultObj.pause_time) / 60;\n    work_time_input.value = isNaN(resultObj.work_time) ? \"n/a\" : Number(resultObj.work_time) / 60;\n    pause_time_input.value = isNaN(resultObj.pause_time) ? \"n/a\" : Number(resultObj.pause_time) / 60;\n    let dates = resultObj.timeline.slice(-1440);\n    if (timeline.length) {\n      const [month, day, hour, min, sec] = timeline[timeline.length - 1].match(/..?/g);\n      document.querySelector('#last_sync_value').innerHTML = `${month}/${day} ${hour}:${min}`;\n    } else {\n      document.querySelector('#last_sync_value').innerHTML = 'n/a';\n    }\n    dates = dates.map(function(dt) {\n      const [month, day, hour, min, sec] = dt.match(/..?/g);\n      //const now = new Date();\n      return `${month}/${day} ${hour}:${min}`;\n    });\n    const temp_values = resultObj.timeline_temp.slice(-1440);\n    const power_values = resultObj.timeline_power.slice(-1440);\n    if (temp_chart_instance) {\n      temp_chart_instance.destroy();\n    }\n    if (power_chart_instance) {\n      power_chart_instance.destroy();\n    }\n    try {\n      temp_chart_instance = new Chart(\"temp_chart\", {\n        type: \"line\",\n        data: {\n          labels: dates,\n          datasets: [{\n            label: \"Temperatura\",\n            fill: false,\n            lineTension: 0,\n            backgroundColor: \"rgba(255,0,0,1.0)\",\n            borderColor: \"rgba(255,0,0,0.75)\",\n            data: temp_values\n          }]\n        }\n      });\n      power_chart_instance = new Chart(\"power_chart\", {\n        type: \"line\",\n        data: {\n          labels: dates,\n          datasets: [{\n            label: \"Energie\",\n            fill: false,\n            lineTension: 0,\n            backgroundColor: \"rgba(0,0,255,1.0)\",\n            borderColor: \"rgba(0,0,255,0.75)\",\n            data: power_values\n          }]\n        }\n      });\n    } catch(err) {\n      console.log(err);\n    }\n  }).catch(function(err) {\n    console.log(err);\n    clearInterval(fetch_interval);\n    alert(\"Nu se poate comunica cu serverul!\");\n    auth_dialog.style.display = 'block';\n  });\n}\n\nif (!password) {\n  auth_dialog.style.display = 'block';\n} else {\n  fetchData();\n  fetch_interval = setInterval(fetchData, 30000);\n}\n\nauth_dialog.querySelector(\".submit\").addEventListener('click', function() {\n  auth_dialog.style.display = 'none';\n \n  clearInterval(fetch_interval);\n  password = auth_dialog.querySelector(\"#pass_input\").value;\n  setTimeout(fetchData, 100);\n  fetchData();\n  fetch_interval = setInterval(fetchData, 30000);\n  window.localStorage.setItem('pass', password);\n});\n\nmin_temp_btn.addEventListener('click', function() {\n  const current = parseFloat(min_temp_value.innerHTML);\n  document.querySelector(\"#min_input\").value = current;\n  min_temp_dialog.style.display = 'block';\n});\nmin_temp_dialog.querySelector('.close').addEventListener('click', function() {\n  min_temp_dialog.style.display = 'none'; \n});\nmin_temp_dialog.querySelector('.submit').addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  setData('min_temp', current);\n  setTimeout(fetchData, 100);\n  min_temp_dialog.style.display = 'none';\n});\nmin_temp_dialog.querySelector(\"#plus_min_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  document.querySelector(\"#min_input\").value = (current + 0.1).toFixed(1);\n});\nmin_temp_dialog.querySelector(\"#minus_min_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#min_input\").value);\n  document.querySelector(\"#min_input\").value = (current - 0.1).toFixed(1);\n});\n\nmax_temp_btn.addEventListener('click', function() {\n  const current = parseFloat(max_temp_value.innerHTML);\n  document.querySelector(\"#max_input\").value = current;\n  max_temp_dialog.style.display = 'block';\n});\nmax_temp_dialog.querySelector('.close').addEventListener('click', function() {\n  max_temp_dialog.style.display = 'none';\n});\nmax_temp_dialog.querySelector('.submit').addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  setData('max_temp', current);\n  setTimeout(fetchData, 100);\n  max_temp_dialog.style.display = 'none';\n});\nmax_temp_dialog.querySelector(\"#plus_max_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  document.querySelector(\"#max_input\").value = (current + 0.1).toFixed(1);\n});\nmax_temp_dialog.querySelector(\"#minus_max_input\").addEventListener('click', function() {\n  const current = parseFloat(document.querySelector(\"#max_input\").value);\n  document.querySelector(\"#max_input\").value = (current - 0.1).toFixed(1);\n});\n\nadvanced_btn.addEventListener('click', function() {\n  advanced_dialog.style.display = 'block';\n});\nadvanced_dialog.querySelector('.close').addEventListener('click', function() {\n  advanced_dialog.style.display = 'none'; \n});\nadvanced_dialog.querySelector('.submit').addEventListener('click', function() {\n  advanced_dialog.style.display = 'none';\n  const work = parseInt(document.querySelector(\"#work_time_input\").value);\n  const pause = parseInt(document.querySelector(\"#pause_time_input\").value);\n  setData('work_time', work * 60);\n  setData('pause_time', pause * 60);\n  setTimeout(fetchData, 100);\n});\nadvanced_dialog.querySelector(\"#plus_work_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#work_time_input\").value);\n  document.querySelector(\"#work_time_input\").value = (current + 10);\n});\nadvanced_dialog.querySelector(\"#minus_work_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#work_time_input\").value);\n  document.querySelector(\"#work_time_input\").value = (current - 10);\n});\nadvanced_dialog.querySelector(\"#plus_pause_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#pause_time_input\").value);\n  document.querySelector(\"#pause_time_input\").value = (current + 10);\n});\nadvanced_dialog.querySelector(\"#minus_pause_input\").addEventListener('click', function() {\n  const current = parseInt(document.querySelector(\"#pause_time_input\").value);\n  document.querySelector(\"#pause_time_input\").value = (current - 10);\n});\n\n"],"names":["$f7cc2df98f0dd786ece54ee206a6d458$var$status_maps","$f7cc2df98f0dd786ece54ee206a6d458$var$status_value","document","querySelector","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$current_temp_value","$f7cc2df98f0dd786ece54ee206a6d458$var$pause_time_value","$f7cc2df98f0dd786ece54ee206a6d458$var$work_time_input","$f7cc2df98f0dd786ece54ee206a6d458$var$pause_time_input","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$advanced_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$auth_dialog","$f7cc2df98f0dd786ece54ee206a6d458$var$min_temp_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$max_temp_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$advanced_btn","$f7cc2df98f0dd786ece54ee206a6d458$var$fetch_interval","$f7cc2df98f0dd786ece54ee206a6d458$var$temp_chart_instance","$f7cc2df98f0dd786ece54ee206a6d458$var$power_chart_instance","$f7cc2df98f0dd786ece54ee206a6d458$var$password","window","localStorage","getItem","$f7cc2df98f0dd786ece54ee206a6d458$var$setData","path","data","Promise","resolve","reject","fetch","$f7cc2df98f0dd786ece54ee206a6d458$var$SERVER_URL","method","body","headers","then","res","ok","json","statusText","catch","err","$f7cc2df98f0dd786ece54ee206a6d458$var$fetchData","requests","all","map","$f7cc2df98f0dd786ece54ee206a6d458$var$getData","results","resultObj","reduce","acc","index","result","innerHTML","isNaN","status","Number","min_temp","max_temp","current_temp","pause_time","value","work_time","dates","timeline","slice","length","month","day","hour","min","sec","match","dt","temp_values","timeline_temp","power_values","timeline_power","destroy","Chart","type","labels","datasets","label","fill","lineTension","backgroundColor","borderColor","console","log","clearInterval","alert","style","display","setInterval","addEventListener","setTimeout","setItem","current","parseFloat","toFixed","work","parseInt","pause"],"version":3,"file":"index.27f26657.js.map"}